<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Social Media App</title>
        <!--CDN for ICONS-->
        <link rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />

        <link rel="stylesheet" href="SocialMedia.css" />

        <link rel="stylesheet"
            href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
        <script
            src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
            integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
            crossorigin="anonymous"></script>
        <script
            src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.min.js"
            integrity="sha384-0pUGZvbkm6XF6gxjEnlmuGrJXVbNuzT9qBBavbLwCsOGabYfZo0T0to5eqruptLy"
            crossorigin="anonymous"></script>
            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>

        <script src="./api.js"></script>
        <script src="./user.js"></script>
        <script src="./comments.js"></script>
        <script src="auth.js"></script>

    </head>
    <body>
        <!--Navbar Section-->
        <nav>
            <div class="Nav-container">
                <h2 class="logo" style="font-size: 22px;">
                    Social Media
                </h2>
                <div class="search-bar">
                    <i class="bi bi-search" id="search-icon"></i>
                    <input type="search" id="search-input" placeholder="Search for anything, which you want to know">
                </div>
                
                <div class="live" onclick="showlivemodal()">
<button>Live</button>
                </div>
                <div class="create">
                    <!--Show Loggedin user-->
                    <label id="usernameLabel" style="color: #022F96; font-weight: bolder;"></label>

                        <div class="profile-photo" style="cursor: pointer; filter: drop-shadow(5px 5px 20px #022F96);" id="profile-photo" onclick="showmodal()">
                            <img  id="profileImage" src alt="Profile Photo">
                        </div>
                        
                </div>
                <div class="logout-card" id="logout-card">
                    <div class="card" style="width: 20rem">
                        <div class="profile-info" style="display: flex; flex-direction: column; align-items: center; margin: 10px; border-radius: 20px;box-shadow: rgba(0, 0, 0, 0.468); background-color: #ADE3FB; border: 1px solid #d2dbdf; padding: 15px;">
                            <img id="logout-profile-image" style="width: 30%; border-radius: 50%; object-fit: cover;" src alt="Profile Photo">
                            <p id="logout-username" style="font-size: 20px; font-weight: bolder;"></p>
                            <p id="logout-birthDate" style="font-size: 16px; margin-top: 2px;"></p>
                            <p id="logout-domain" style="font-size: 16px; color: #022F96; text-decoration: none; cursor: pointer; transition: color 0.3s ease;"></p>
                            
                            
                        </div>

                        <ul>
                            <li>
                                <i class="fa-solid fa-user"></i>
                                <p>Profile</p>
                            </li>
                            <li>
                                <i class="fa-regular fa-bookmark"></i>
                                <p>Saved</p>
                            </li>
                            <li>
                                <i class="fa-solid fa-info"></i>
                                <p>Info</p>
                            </li>
                            <li>
                                <i class="fa-solid fa-gear"></i>
                                <p>Setting</p>
                            </li>
                            <li>
                                <i class="fa-solid fa-circle-half-stroke"></i>
                                <p>Theme</p>
                            </li>
                            <div id="logout"
                                style="display: flex; gap: 20px; color: red; padding: 20px 0px; cursor: pointer;">
                                <i class="fa-solid fa-right-from-bracket"></i>
                                <p>Logout</p>
                            </div>

                        </ul>
                    </div>
                </div>

            </div>
        </nav>

        <!--Main Section-->
        <main>
            <div class="container">
                <!--Left Section-->
                <div class="left">

                    <!--Sidebar-->
                    <div class="sidebar-top">
                        <a class="profile">
                            <div class="handle">
                                <h3>YOUR GROUPS</h3>
                            </div>
                        </a>
                        <a class="profile">
                            <div class="profile-photo">
                                <img src="./img/figma.png">
                            </div>
                            <div class="handle">
                                <h4>Figma Community</h4>
                            </div>
                        </a>
                        <a class="profile">
                            <div class="profile-photo">
                                <img src="./img/sketch.png">
                            </div>
                            <div class="handle">
                                <h4>Sketch Community</h4>
                            </div>
                        </a>

                    </div>

                    <div class="sidebar">
                        <h3
                            style="margin-left: 1.2rem; font-size: 0.8rem;">Friends</h3>
                        <div id="user-list"></div>
                        <a class="profile">

                            <!-- <div class="handle">
                                <h3>Friends</h3>
                            </div> -->

                        </a>
                        <!-- <a class="profile">
                            <div class="profile-photo">
                                <img src="./img/Dp.jpg">
                            </div>
                            <div class="handle">
                                <h2>Hassaan Gul</h2>
                            </div>
                            <i class="fa-solid fa-circle"
                                style="color: #01F4F7"></i>
                        </a>

                        <a class="profile">
                            <div class="profile-photo">
                                <img src="./img/Dp-1.jpg">
                            </div>
                            <div class="handle">
                                <h2>Salman</h2>
                            </div>
                            <h6 class="text-muted">
                                Active 11 min ago
                            </h6>
                        </a>
                        <a class="profile">
                            <div class="profile-photo">
                                <img src="./img/Dp-2.jpg">
                            </div>
                            <div class="handle">
                                <h2>Babar Azam</h2>
                            </div>
                            <i class="fa-solid fa-circle"
                                style="color: #01F4F7"></i>
                        </a>
                        <a class="profile">
                            <div class="profile-photo">
                                <img src="./img/Dp-3.jpg">
                            </div>
                            <div class="handle">
                                <h2>Ahmad </h2>
                            </div>
                            <h6 class="text-muted">
                                Active 3 hours ago
                            </h6>
                        </a>
                        <a class="profile">
                            <div class="profile-photo">
                                <img src="./img/Dp-4.jpg">
                            </div>
                            <div class="handle">
                                <h2>Mister Amir</h2>
                            </div>
                            <i class="fa-solid fa-circle"
                                style="color: #01F4F7"></i>
                        </a> -->
                    </div>
                    <!--Sidebar End-->
                    <label class="btn btn-primary" for="create-post">Create
                        Post</label>
                </div>

                <!--Middle Section-->
                <div class="middle">
                    <div class="stories">
                        <div class="carousel-controls">
                            <button id="prevBtn">&lt;</button>
                            <button id="nextBtn">&gt;</button>
                        </div>

                        <ul class="carousel">
                            <li>
                                <div class="outer-layer">
                                    <a href><img src="./img/Dp.jpg"></a>
                                    <button>+</button>
                                </div>
                                <span>Hassaan1</span>
                            </li>

                            <li>
                                <div class="outer-layer">
                                    <a href><img src="./img/dp-1.jpg"></a>
                                </div>
                                <span>Hassaan2</span>

                            </li>

                            <li>
                                <div class="outer-layer">
                                    <a href><img src="./img/dp-2.jpg"></a>
                                </div>
                                <span>Hassaan3</span>

                            </li>

                            <li>
                                <div class="outer-layer">
                                    <a href><img src="./img/dp-3.jpg"></a>
                                </div>
                                <span>Hassaan4</span>

                            </li>

                            <li>
                                <div class="outer-layer">
                                    <a href><img src="./img/dp-4.jpg"></a>
                                </div>
                                <span>Hassaan5</span>

                            </li>

                            <li>
                                <div class="outer-layer">
                                    <a href><img src="./img/Dp.jpg"></a>
                                </div>
                                <span>Hassaan6</span>

                            </li>

                            <li>
                                <div class="outer-layer">
                                    <a href><img src="./img/dp-1.jpg"></a>
                                </div>
                                <span>Hassaan7</span>

                            </li>
                            <li>
                                <div class="outer-layer">
                                    <a href><img src="./img/dp-1.jpg"></a>
                                </div>
                                <span>Hassaan8</span>

                            </li>
                            <li>
                                <div class="outer-layer">
                                    <a href><img src="./img/dp-1.jpg"></a>
                                </div>
                                <span>Hassaan9</span>

                            </li>
                        </ul>

                    </div>

                    <!--Bootstrap Card-->
                    <!--customize bootstrap card-->
                    <!--Getting data from API-->
                    <div style="margin-top: 3rem;">
                        <!--Card Div-->

                        <div id="post-list"></div>
                        <!--Card Div End-->
                    </div>
                    <!--post -->

                    <!--post end-->

                </div>

                <!--Right Section-->
                <div class="right" id="liveright"
                    style="background-color: white; height: fit-content;">
                    <div id="video-container"
                        style="border-radius: 20px; margin-top: 0;">
                        <video width="100%"
                            style="border-radius: 20px 20px 0px 0px; " autoplay
                            loop controls>
                            <source src="./img/option1.mp4" type="video/mp4">
                        </video>

                    </div>
                    <div
                        style="position: relative; display: flex; justify-content: center;">
                        <div
                            style="background-color: #022f96;  position: absolute;z-index: 5; top: -25px; color: rgba(255, 255, 255, 0.802); border-radius: 5px; width: 80%; padding: 0 10px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; padding: 2px;">
                                <div
                                    style="display: flex; flex-direction: column; padding: 2px 0px;">
                                    <divstyle="font-size: 12px;"><p>live
                                            chat</p></divstyle=>
                                    <div style="font-size: 12px;"><p><i
                                                class="fa-regular fa-user"></i>&nbsp;&nbsp;15K
                                            people</p></div>
                                </div>
                                <div class="chat-icons"
                                    style="font-size: 12px;"><i
                                        class="fa-solid fa-sliders"
                                        style="margin-right: 10px;"></i><i
                                        class="fa-solid fa-xmark"></i></div>
                            </div>
                        </div></div>

                    <div class="All-comment-box"
                        style="background-color:white; margin-top: -10px; height: 60vh; overflow-y: scroll;">
                        <div
                            style="display: flex; padding: 5px 10px; gap: 20px; border-radius: 15px; background-color: #F0EFEF; margin: 30px auto; width: 90%; align-items: center;">
                            <div style="flex: 0 0 auto;">
                                <i style="color: rgba(255, 217, 0, 0.892);"
                                    class="fa-solid fa-gem"></i>
                            </div>
                            <div style="display: flex; flex-direction: column;">
                                <div
                                    style="font-size: 15px; font-weight: bolder;">Hassaan</div>
                                <div
                                    style="font-size: 11px; font-weight: 200;">How
                                    to make professional website</div>
                            </div>
                        </div>

                        <div id="comments-container" class="comments-container">
                        </div>
                        <div class="comment-box">
                            <input id="comment-text" type="text"
                                class="comment-input"
                                placeholder="😊 Add comment...">
                            <i id="send-comment"
                                class="fas fa-paper-plane send-icon"></i>
                        </div>

                    </div>

                </div>
            </main>
        </body>
        <script>
        document.addEventListener("DOMContentLoaded", function() {
            const carousel = document.querySelector('.carousel');
            const carouselItems = document.querySelectorAll('.carousel li');
            const totalItems = carouselItems.length;
            const itemsPerPage = 7;
            let currentIndex = 0;
            
            function showItems(startIndex) {
                const endIndex = startIndex + itemsPerPage - 1;
                for (let i = 0; i < totalItems; i++) {
                    if (i >= startIndex && i <= endIndex) {
                        carouselItems[i].style.display = 'block';
                    } else {
                        carouselItems[i].style.display = 'none';
                    }
                }
            }
    
            function nextItems() {
                const nextIndex = currentIndex + 1;
                if (nextIndex + itemsPerPage - 1 < totalItems) {
                    currentIndex = nextIndex;
                    showItems(currentIndex);
                    updateButtons();
                }
            }
    
            function prevItems() {
                const prevIndex = currentIndex - 1;
                if (prevIndex >= 0) {
                    currentIndex = prevIndex;
                    showItems(currentIndex);
                    updateButtons();
                }
            }
    
            // Show the first set of items initially
            showItems(currentIndex);
            
            // Update the visibility and position of prev/next buttons based on currentIndex
            function updateButtons() {
                document.getElementById('prevBtn').style.display = currentIndex === 0 ? 'none' : 'block';
                document.getElementById('prevBtn').style.left = currentIndex === 0 ? '0' : '';
                const nextButtonIndex = currentIndex + itemsPerPage - 1;
                document.getElementById('nextBtn').style.display = nextButtonIndex >= totalItems - 1 ? 'none' : 'block';
                if (nextButtonIndex < totalItems - 1) {
                    const nextButtonPosition = carouselItems[nextButtonIndex].offsetTop + carouselItems[nextButtonIndex].offsetHeight + 'px';
                    document.getElementById('nextBtn').style.position = 'absolute';
                    document.getElementById('nextBtn').style.top = '10';
                    document.getElementById('nextBtn').style.left = '700px';
                    
                    
                }
            }
            updateButtons();
            
            // Event listeners for prev/next buttons
            document.getElementById('nextBtn').addEventListener('click', nextItems);
            document.getElementById('prevBtn').addEventListener('click', prevItems);
        });
        </script>

<script>
    window.onload = function() {
        console.log(localStorage);

        // Retrieve user data from localStorage
        const FirstName = localStorage.getItem("FirstName");
        const userProfile = localStorage.getItem("UserProfile");
        const birthDate = localStorage.getItem("BirthDate");
        const domain = localStorage.getItem("Domain");

        console.log("FirstName:", FirstName);
        console.log("UserProfile:", userProfile);
        console.log("BirthDate:", birthDate);
        console.log("Domain:", domain);

        // Update HTML elements with user data
        document.getElementById('logout-username').innerText = FirstName;
        document.getElementById('usernameLabel').innerText = FirstName;
        document.getElementById('profileImage').src = userProfile; 
        document.getElementById('logout-profile-image').src = userProfile;
        document.getElementById('logout-birthDate').innerText = birthDate;
        document.getElementById('logout-domain').innerText = domain;

        const token = localStorage.getItem('token');
        console.log("Token : " , token)
        if (!token) {
            // Token is not present, redirect to index.html
            window.location.href = "index.html";
        } else {
            // Make a request to get the current authenticated user
            fetch('https://dummyjson.com/auth/me', {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            })
            .then(response => {
                if (!response.ok) {
                    // If the request fails, redirect to index.html
                    window.location.href = "index.html";
                } else {
                    // If the request is successful, stay on socialmedia.html
                    console.log('User is authenticated');
                }
            })
            .catch(error => {
                console.error('Error fetching current user:', error);
                // If there's an error, redirect to index.html
                window.location.href = "index.html";
            });
        }
    };
</script>

<script>
    document.getElementById('logout').addEventListener('click', function() {
        // Display the alert
        let timerInterval;
        Swal.fire({
            title: "Logging Out!",
            html: "I will close in <b></b> milliseconds.",
            timer: 2000,
            timerProgressBar: true,
            didOpen: () => {
                Swal.showLoading();
                const timer = Swal.getPopup().querySelector("b");
                timerInterval = setInterval(() => {
                    timer.textContent = `${Swal.getTimerLeft()}`;
                }, 100);
            },
            willClose: () => {
                clearInterval(timerInterval);
            }
        }).then((result) => {
            /* Read more about handling dismissals below */
            if (result.dismiss === Swal.DismissReason.timer) {
                console.log("I was closed by the timer");
            }
            // Remove token or any other relevant data from localStorage
            localStorage.removeItem('token');
            // Redirect to index.html or any other desired page
            window.location.href = 'index.html';
        });
    });
    </script>
    


<script>
   class User {
    constructor(id, firstName, image, company) {
        this.id = id;
        this.firstName = firstName;
        this.image = image;
        this.company = company;
    }
}

class SearchService {
    constructor() {
        this.users = [];
    }

    fetchUsersData() {
        fetch('https://dummyjson.com/users')
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(userData => {
                this.users = userData.users.map(user => new User(user.id, user.firstName, user.image, user.company));
            })
            .catch(error => console.error('Error fetching users data:', error));
    }

    fetchSearchResults(query) {
        const searchUrl = `https://dummyjson.com/posts/search?q=${query}`;

        return fetch(searchUrl)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => data.posts)
            .catch(error => {
                console.error('Error fetching search results:', error);
                return [];
            });
    }

    performSearch(query) {
        return this.fetchSearchResults(query)
            .then(searchResults => {
                return { searchResults, users: this.users };
            });
    }
}

class UIManager {
    constructor(searchService) {
        this.searchService = searchService;
        this.searchInput = document.getElementById('search-input');
        this.searchIcon = document.getElementById('search-icon');
        this.postList = document.getElementById('post-list');

        // Bind event listener
        this.searchIcon.addEventListener('click', () => this.handleSearch());
        this.searchInput.addEventListener('keyup', event => {
            if (event.key === 'Enter') {
                event.preventDefault();
                this.handleSearch();
            }
        });
    }

    displaySearchResults(searchResults, users) {
        this.postList.innerHTML = '';

        if (searchResults.length > 0) {
            searchResults.forEach(post => {
                const user = users.find(user => user.id === post.userId);

                if (user) {
                    const highlightedTitle = post.title.replace(new RegExp(this.searchInput.value, 'gi'), '<span style="color: #01F4F7; font-weight:bolder;">$&</span>');
                    const highlightedBody = post.body ? post.body.replace(new RegExp(this.searchInput.value, 'gi'), '<span style="color: #01F4F7; font-weight:bolder;">$&</span>') : 'No description provided.';

                    const cardHtml = `
          <div style="margin-top: 3rem;">
            <div class="card"
              style="border-radius:20px; width: 100%; height:fit-content;   background-color: white; box-shadow: 0 0 10px 0 rgb(220, 220, 220); gap: 20px; margin: 0 auto;">
              <div class="card-data" style="display: grid; grid-template-columns: 40% 60%;">
              <div style="border-radius: 20px; overflow: hidden;">
                  <img class="card-img-top"
                    style="padding: 10px; height: 100%; width: 100%; aspect-ratio: 1/1; border-radius: 20px;"
                    src="${post.imageUrl ? post.imageUrl : './img/post2.png'}" alt="Post Image">
                </div>
                <div class="card-parent">
                  <div id="newcard" class="div card-step-1" style="display: flex;  padding: 10px; gap: 1rem;">
                    <div class="div price">
                      <p style="background-color: #01F4F7; padding: 30px 10px; border-radius: 20px; color: #022e96b6; max-width: 7vw; font-size: 25px; text-align: center; font-weight: 800;">
                   MAY 08
                      </p>
                    </div>
                    <div class="div heading" style="display: flex; flex-direction: column;">
                      <div class="div heading-main">
                        <p style="font-size: 20px; font-weight: bolder;">
                            ${highlightedTitle}
                        </p>
                      </div>
                      <div class="div heading-para">
                        <h5 class="card-title" style="color: #B8B8BF; font-weight: bold; margin-top: 1rem;">
                        <span style="color: black; font-weight: bold;">Genre: </span> #${post.tags}
                        </h5>
                      </div>
                    </div>
                  </div>
                  <div id="contentContainer" style="max-height: 7vh; overflow: hidden;">
                    <p id="content" style="color: #CFCFD4; font-weight: 400; margin:0px 10px; font-size:0.7rem">
                        ${highlightedBody}
                    </p>
                  </div>
                  <button id="showMoreBtn" style="background-color:white; margin-right:10px; float:right; color:black;" onclick="showMore()">Show More</button>
                  <!--Horizontal Line-->
                  <hr>
                  <!--Horizontal Line End-->

                  <!--Profile and designation-->
                  <div id="bottom-section" class="card-bottom"
                    style="display: flex; flex-direction: row; gap: 10px; margin: 5px;">
                    <div id="userimage" style="width: 7%; height: 7%;"><img
                        src="${user.image}"
                        style="border-radius: 50%;  aspect-ratio: 1/1;" /></div>
                    <div
                      style="display: flex; flex-direction: column;">
                      <div id="firstname"><p
                          style="font-weight: bolder; font-size:15px;">${user.firstName}</p></div>
                      <div style="display: flex;">
                        <div id="companyName">
                          <p
                            style="color: #B8B8BF; font-size:12px;">${user.company.title} <span
                              style="color: #CFCFD4;">at</span></p>
                        </div>
                        
                        <div id="paypal-img">
                          <img style="height: 17px;"
                            src="./img/paypal.png" />
                        </div>
                      </div>
                    </div>
                  </div>
                  <!--Profile and designation End-->

                  <!--Comment and Like,Share section-->
                  <div id="comment"
                    style="display: flex; align-items: center; text-align: center; gap: 200px; margin-left: 5px;">


                    <!--Comments Button-->
                    <div 
                      style="display: flex; background-color: #022f96; width: fit-content; padding: 2px; border-radius: 20px; margin-top: 0px; text-align: center; align-items: center; gap: .2rem;">
                      <div><p
                          style="background-color:#01F4F7; color: #022f96; border-radius: 50%; padding: 7px; font-size: 11px; font-weight: bolder; margin: 0px;">73</p></div>
                      <div><p
                          style="color: white !important; font-size:10px; font-weight: bolder; padding-right: .3rem;">Comments</p></div>
                    </div>
                    <!--Comments Button End-->


                    <!--Like and Share Button-->

                    <div style="float: inline-end; ">
                      <i
                        style="animation: fireAnimation 2s infinite alternate; color: #ff0000;"
                        class="bi bi-fire"></i>
                      ${post.reactions}
                      <i class="fa-solid fa-share"
                        style="color: rgb(0, 208, 255);"></i>
                      12
                    </div>

                    <!--Like and Share Button End-->
                  </div>
                  <!-- Add additional sections as needed -->
                </div>
              </div>
              <!--Comment Div-->
              <!--<div style="display: flex;">
              <div class="comment-input-container">
                <input class="comment-input" placeholder="Add your comment..." required></input>
                <button class="add-comment-btn" onclick="postComment()">Post Comment</button>
              </div>

              <div class="comments-section">
                <!-- Comments will be displayed here -->
              </div>

            </div>
              
              <!--Comment Div End-->
            </div>
          </div>
          `;
          this.postList.innerHTML += cardHtml;
                } else {
                    console.error('User not found for post:', post);
                }
            });
        } else {
            const imageElement = document.createElement('img');
            imageElement.src = './img/error.svg';
            imageElement.style.width = '50%';
            imageElement.style.height = '100%';
            imageElement.style.marginTop = '100px';
            imageElement.style.display = 'block';
            imageElement.style.marginLeft = 'auto';
            imageElement.style.marginRight = 'auto';
            this.postList.appendChild(imageElement);
        }
    }

    handleSearch() {
        const query = this.searchInput.value.trim();

        if (query !== '') {
            this.searchService.performSearch(query)
                .then(({ searchResults, users }) => {
                    this.displaySearchResults(searchResults, users);
                })
                .catch(error => console.error('Error performing search:', error));
        }
    }
}

// Usage
const searchService = new SearchService();
const uiManager = new UIManager(searchService);

// Fetch initial data
searchService.fetchUsersData();



</script>

        
    </html>